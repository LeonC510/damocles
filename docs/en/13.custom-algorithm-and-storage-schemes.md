# Custom Algorithm and Storage Schemes

## Overview

While providing a robust computing power generation solution, `damocles` hopes to allow users to maximize flexibility in configuring and customizing their own usage based on actual needs. This includes custom algorithm and storage schemes. For example, users can choose to:

- Use open-source optimization algorithms
 - Purchase licensed proprietary algorithms
 - Purchase outsourced computing services
 - Use object storage (such as S3) as their own persistence storage solution

and integrate these custom schemes into damocles at very low costs.

## Usage

For custom algorithms and storage schemes, `SP` and developers need to pay attention to different things. We will explain them separately here.

### SP

For `SP`, you just need to focus on how to integrate custom contents into the computing power generation process. This can be divided into several parts:

### ext-processors on damocles-worker

To integrate ext-processors on damocles-worker, follow these steps:

1. Prepare executable files that conform to the interaction protocol

2. In the damocles-worker config file under `[[processors.{stage_name}]] ` blocks, correctly configure the stages to enable, executable file locations, parameters, environment variables, etc.

3. Start damocles-worker and check if the custom external processors work as expected.

For more details, refer to:

07. Configuration examples of ext-processors for damocles-worker

03. Configuration spec of damocles-worker

### ext-provers on damocles-manager

On damocles-manager, algorithm customization only involves the wining post and window post parts, which can be customized via ext-provers. The mechanism and usage method are very similar to ext-processors.

For more details, refer to:

09. Standalone poster nodes #ext-prover executor.

### Custom Storage Schemes

Custom storage schemes can be completely non-filesystem-based solutions like object storage, or simplified versions of traditional large-scale filesystems, such as simplifying NFS mounts to a lightweight custom data access method.

Compared to ext-processors and ext-provers, supporting custom storage is relatively more complex, mainly reflected in:

1. Support for custom storage involves multiple scenarios, such as data persistence during sector sealing, access to raw data during sector upgrading, winning post, window post, etc.

2. Both damocles-manager and damocles-worker involve some interaction behaviors with storage instances.

In simple terms, to be able to use a custom storage scheme, you need to configure at least:

1. An ext-processor transfer stage for damocles-worker that supports this storage scheme

2. ext-provers for winning post and window post in damocles-manager that support this storage scheme

3. An objstore plugin in damocles-manager config that supports this storage scheme, refer to 04. damocles-manager config spec

With the above in place, damocles can work based on the customized storage scheme.

### Developers

For developers, the most important thing is to develop suitable custom components like external processors and Golang plugins that conform to the interfaces and protocols defined by damocles.

#### ext-processors / ext-provers

From a development perspective, ext-processors and ext-provers are the same kind of implementations used in different scenarios.

Their basic principle is an executable file that:

- Interacts with parent process via stdin/stdout
- Conforms to the interaction protocol and data formats defined by [vc-processors](https://crates.io/crates/vc-processors)

Developers can learn the basics via:

1. Understand the principles and mechanisms, refer to [vc-processors: examples](https://github.com/ipfs-force-community/damocles/tree/vc-processors/v0.1.5/damocles-worker/vc-processors/examples)
2. Implement algorithms for stages needing customization, refer to [vc-processors: builtin/processors](https://github.com/ipfs-force-community/damocles/blob/vc-processors/v0.1.5/damocles-worker/vc-processors/src/builtin/processors.rs).
3. Package implemented algorithms into executables, refer to [vc-worker: subcommand/processors](https://github.com/ipfs-force-community/damocles/blob/vc-processors/v0.1.5/damocles-worker/src/bin/damocles-worker/processor/mod.rs).

#### damocles-manager objstore plugin

it essentially is the plugin of Golang that:

- Meet [golang plugin](https://pkg.go.dev/plugin) requirements and constraints
- Conform to interfaces and semantics defined by [damocles-manager objstore](https://github.com/ipfs-force-community/damocles/blob/main/manager-plugin/objstore/objstore.go#L50-L61)

Developers can learn the basics of developing processes via:

1. Understand the damocles-manager [plugin framework](https://github.com/ipfs-force-community/damocles/tree/main/manager-plugin)

2. Understand interface definitions and working ways, refer to: [damocles-manager objstore: Store](https://github.com/ipfs-force-community/damocles/blob/main/manager-plugin/objstore/objstore.go#L50-L61) and [objstore: spi](https://github.com/ipfs-force-community/damocles/blob/main/manager-plugin/spi.go#L69-L73)

3. Understand example implementations [damocles-manager: plugin/fsstore](https://github.com/ipfs-force-community/damocles/tree/main/manager-plugin/examples/fsstore)